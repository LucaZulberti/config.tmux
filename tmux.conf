# Set the default terminal
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -s escape-time 0

# Change prefix key
unbind C-b
set-option -g prefix C-Space
bind C-Space send-prefix

# Reload tmux config
bind r source-file ~/.config/tmux/tmux.conf

# Kill current session
bind C-Q kill-session

# Kill server
bind Q kill-server

# Set the base index for windows to 1
set -g base-index 1

# Disable mouse support
set -g mouse off

# Use vi keybindings in copy mode
# -------------------------------
set-window-option -g mode-keys vi

# Bind 'v' to start selection in copy-mode (vi-style)
bind -T copy-mode-vi v send-keys -X begin-selection

# Bind 'y' to copy to system clipboard and cancel copy-mode
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'
# -------------------------------

# Rotate on windows
# -------------------------------
bind -r C-a last-window
bind -n M-H previous-window
bind -n M-L next-window
# -------------------------------

# Panes
# -------------------------------
# Split panes using | and -, open in current path
unbind '%'
bind '|' split-window -h -c "#{pane_current_path}"
unbind '"'
bind '-' split-window -v -c "#{pane_current_path}"

# Resize panes using
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r K resize-pane -U 5
bind -r J resize-pane -D 5

# Kill pane confirmation default to yes
bind x confirm-before -y -p "Kill pane #P (y/n)? [y]" kill-pane

# Respawn current pane (even if not dead)
bind -r R respawn-pane -k
# -------------------------------

# Misc
# -------------------------------
# Open TODO file in new window
bind -r D neww -c "#{pane_current_path}" "if test -e TODO.md; and nvim TODO.md; else; nvim ~/.dotfiles/personal/todo.md; end"

# Forget the find window. That is for chumps
bind -r f run-shell "tmux neww ~/.config/tmuxp/tmuxp-sessionizer"
# -------------------------------

# Tmux Plugin Manager
# --------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'olimorris/tmux-pomodoro-plus'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'arl/gitmux'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
# --------------------------------

# Config plugin 'catppuccin/tmux'
# --------------------------------
set -g @catppuccin_flavor "mocha" # latte, frappe, macchiato or mocha
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_flags "icon"

# Config plugin 'vim-tmux-navigator'
# --------------------------------
set -g @vim_navigator_mapping_left "C-h"
set -g @vim_navigator_mapping_right "C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev "C-\\"
# --------------------------------

# Config plugin 'tmux-pomodoro-plus'
# --------------------------------
set -g @pomodoro_toggle 't'     # Start/pause a Pomodoro/break, C-t to open menu for custom timings
set -g @pomodoro_cancel 'T'     # Cancel the current Pomodoro timer
set -g @pomodoro_skip 'M-t'     # Skip a Pomodoro/break
set -g @pomodoro_restart 'M-r'  # Restart the Pomodoro timer

set -g @pomodoro_sound "on"
set -g @pomodoro_notifications "on"
set -g @pomodoro_granularity "on"

set -g @pomodoro_intervals "8"  # 4h
set -g @pomodoro_repeat "no"

set -g @pomodoro_on " "
set -g @pomodoro_complete " "
set -g @pomodoro_pause " "
set -g @pomodoro_prompt_break " ? prefix-p to confirm"
set -g @pomodoro_prompt_pomodoro " ? prefix-p to confirm"

set -g @pomodoro_interval_display " %s/%s"
# --------------------------------

# Make the status line pretty and add some modules
# --------------------------------
set -g status-right-length 100
set -g status-left-length 100

set -g status-left ""

set -g status-right ""
set -agF status-right "#{E:@catppuccin_status_gitmux}"
set -agF status-right "#{E:@catppuccin_status_pomodoro_plus}"
set -ag status-right "#{E:@catppuccin_status_session}"

# Update status bar every second
set -g status-interval 1
# --------------------------------

# --------------------------------
# Initliaze TMUX Plugin Manager
run '~/.config/tmux/plugins/tpm/tpm'
