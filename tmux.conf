# Set the default terminal
set -ga terminal-overrides ",*:Tc"
set -s escape-time 0

# Change prefix key
unbind C-b
set-option -g prefix C-Space
bind C-Space send-prefix

# Reload tmux config
bind r source-file ~/.config/tmux/tmux.conf

# Kill current session
bind Q kill-session

# Set the base index for windows to 1
set -g base-index 1

# Enable mouse support
set -g mouse on

# Use vi keybindings in copy mode
# -------------------------------
set-window-option -g mode-keys vi

# Bind 'v' to start selection in copy-mode (vi-style)
bind -T copy-mode-vi v send-keys -X begin-selection

# Bind 'y' to copy to system clipboard and cancel copy-mode
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'
# -------------------------------

# Rotate on windows
# -------------------------------
bind -r C-a last-window
bind -n M-H previous-window
bind -n M-L next-window
# -------------------------------

# Panes
# -------------------------------
# Split panes using | and -, open in current path
unbind '%'
bind '|' split-window -h -c "#{pane_current_path}"
unbind '"'
bind '-' split-window -v -c "#{pane_current_path}"

# Resize panes using
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r K resize-pane -U 5
bind -r J resize-pane -D 5

# Kill pane confirmation default to yes
bind x confirm-before -y -p "Kill pane #P (y/n)? [y]" kill-pane

# Respawn current pane (even if not dead)
bind -r R respawn-pane -k
# -------------------------------

# Misc
# -------------------------------
# Open TODO file in new window
bind -r D neww -c "#{pane_current_path}" "if test -e TODO.md; and nvim TODO.md; else; nvim ~/.dotfiles/personal/todo.md; end"

# Forget the find window. That is for chumps
bind -r f run-shell "tmux neww ~/.config/tmuxp/tmuxp-sessionizer"
# -------------------------------

# Tmux Plugin Manager
# --------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'erikw/tmux-powerline'
set -g @plugin 'olimorris/tmux-pomodoro-plus'
# --------------------------------

# Config plugin 'tmux-sessionx'
# --------------------------------
set -g @sessionx-bind 'o'

# A boolean flag, if set to true, will also display subdirectories
# under the aforementioned custom paths, e.g. /Users/me/projects/tmux-sessionx
#set -g @sessionx-custom-paths-subdirectories 'false'

# Uses `fzf --tmux` instead of the `fzf-tmux` script (requires fzf >= 0.53).
set -g @sessionx-fzf-builtin-tmux 'on'

# By default, the current session will not be shown on first view
# This is to support quick switch of sessions
# Only after other actions (e.g. rename) will the current session appear
# Setting this option to 'false' changes this default behavior
#set -g @sessionx-filter-current 'false'

# Window mode can be turned on so that the default layout
# Has all the windows listed rather than sessions only
set -g @sessionx-window-mode 'on'

# Tree mode can be enabled which means that instead of a preview,
# a hierarchy of sessions and windows will be shown
set -g @sessionx-tree-mode 'on'

# Preview location and screenspace can be adjusted with these
# Reminder: it can be toggled on/off with `?`
set -g @sessionx-preview-location 'right'
set -g @sessionx-preview-ratio '55%'

# The preview can also be disabled altogether with 'false'
set -g @sessionx-preview-enabled 'false'

# Change window dimensions
set -g @sessionx-window-height '90%'
set -g @sessionx-window-width '75%'

# If you want to change the prompt, the space is needed to not overlap the icon
#set -g @sessionx-prompt " "

# If you want to change the pointer
#set -g @sessionx-pointer "▶ "

# Customize `ls` command to display your directories nicely (default: `ls`)
# Can be used with `exa`, `lsd`, or other command of your choice to
# set preview window to match your preference
#set -g @sessionx-ls-command 'lsd --tree --color=always --icon=always'

# When set to 'on' a non-result will be sent to zoxide for path matching
# Requires zoxide installed
set -g @sessionx-zoxide-mode 'on'
# --------------------------------

# Config plugin 'vim-tmux-navigator'
# --------------------------------
set -g @vim_navigator_mapping_left "C-h"
set -g @vim_navigator_mapping_right "C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev "C-\\"
# --------------------------------

# Config plugin 'tmux-powerline'
# --------------------------------
# Configurations for tmux-powerline is in ~/.config/tmux-powerline
# --------------------------------

# Config plugin 'tmux-pomodoro-plus'
# --------------------------------
set -g @pomodoro_sound "on"
set -g @pomodoro_notifications "on"
set -g @pomodoro_granularity "on"

set -g @pomodoro_intervals "8"  # 4h
set -g @pomodoro_repeat "no"

set -g @pomodoro_on " "
set -g @pomodoro_complete " "
set -g @pomodoro_pause " "
set -g @pomodoro_prompt_break " ? prefix-p to confirm"
set -g @pomodoro_prompt_pomodoro " ? prefix-p to confirm"

# set -g @pomodoro_interval_display " \$(seq %s) %s/%s"
set -g @pomodoro_interval_display " %s/%s"
# --------------------------------

# Initliaze TMUX Plugin Manager
run '~/.config/tmux/plugins/tpm/tpm'
